<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard | SPK TOPSIS Laptop</title>
  <style>
/* ================= RESET ================= */
* {
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea, #764ba2);
}

/* ================= LAYOUT ================= */
.container {
  max-width: 1150px;
  margin: auto;
  padding: 30px;
}

/* ================= HEADER ================= */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #fff;
  margin-bottom: 30px;
}

.header h2 {
  margin: 0;
  font-size: 26px;
}

.subtitle {
  margin-top: 6px;
  font-size: 14px;
  opacity: 0.85;
}

/* ================= CARD ================= */
.card {
  background: #ffffff;
  border-radius: 14px;
  padding: 25px 28px;
  margin-bottom: 30px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.card h3 {
  margin-top: 0;
  margin-bottom: 22px;
  color: #333;
  font-size: 20px;
}

/* ================= FORM ================= */
.form-group {
  margin-bottom: 18px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: #444;
}

input {
  width: 100%;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  transition: 0.2s ease;
}

input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102,126,234,0.2);
}

/* ================= BUTTON ================= */
.btn {
  padding: 11px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s ease;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea, #5a6fdc);
  color: #fff;
}

.btn-primary:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 15px rgba(102,126,234,0.4);
}

.btn-success {
  background: linear-gradient(135deg, #28a745, #219653);
  color: #fff;
}

.btn-success:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 15px rgba(40,167,69,0.4);
}

.btn-outline {
  background: transparent;
  color: #fff;
  border: 2px solid #fff;
}

.btn-outline:hover {
  background: #fff;
  color: #667eea;
}

/* ================= TABLE ================= */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

thead {
  background: #667eea;
  color: #fff;
}

th, td {
  padding: 12px 14px;
  text-align: left;
  font-size: 14px;
}

tbody tr {
  border-bottom: 1px solid #e5e7eb;
}

tbody tr:nth-child(even) {
  background: #f4f6ff;
}

tbody tr:hover {
  background: #e8ebff;
}

/* ================= ACTION BUTTON ================= */
td .btn {
  padding: 7px 12px;
  font-size: 13px;
  margin-right: 5px;
}

/* ================= RESULT ================= */
.result-list {
  margin-top: 20px;
  padding-left: 0;
}

.result-list li {
  list-style: none;
  background: linear-gradient(135deg, #f4f6ff, #eef1ff);
  padding: 14px 16px;
  margin-bottom: 12px;
  border-radius: 10px;
  font-weight: 600;
  box-shadow: 0 8px 18px rgba(0,0,0,0.1);
}

/* ================= FOOTER ================= */
footer {
  text-align: center;
  margin-top: 40px;
  color: #fff;
  font-size: 14px;
  opacity: 0.85;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }

  table {
    font-size: 13px;
  }

  th, td {
    padding: 10px;
  }
}

  </style>
</head>

<body onload="checkAuth('user')">

<div class="container">

<header class="header">
  <div>
    <h2>Dashboard User</h2>
    <p class="subtitle">Input Data Laptop & Rekomendasi TOPSIS</p>
  </div>
  <button class="btn btn-outline" onclick="logout()">Logout</button>
</header>

<div class="card">
  <h3>ðŸ’» Input Data Laptop</h3>

  <div class="form-group">
    <label>Nama Laptop</label>
    <input id="name">
  </div>

  <div class="form-group">
    <label>Harga (Cost)</label>
    <input id="price" type="number">
  </div>

  <div class="form-group">
    <label>RAM (GB)</label>
    <input id="ram" type="number">
  </div>

  <div class="form-group">
    <label>Storage (GB)</label>
    <input id="storage" type="number">
  </div>

  <div class="form-group">
    <label>Processor Score</label>
    <input id="processor" type="number">
  </div>

  <button class="btn btn-primary" onclick="saveLaptop()">Simpan Laptop</button>
</div>

<!-- DAFTAR LAPTOP -->
<div class="card">
  <h3>ðŸ“‹ Daftar Laptop</h3>

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Harga</th>
        <th>RAM</th>
        <th>Storage</th>
        <th>Processor</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="laptopTable"></tbody>
  </table>
</div>

<div class="card">
  <h3>ðŸ“Š Hasil Rekomendasi TOPSIS</h3>
  <button class="btn btn-success" onclick="getResult()">Hitung Rekomendasi</button>
  <ol id="result" class="result-list"></ol>
</div>

<footer>Â© 2026 â€¢ SPK Pemilihan Laptop (TOPSIS)</footer>
</div>
<script src="js/auth.js"></script>
<script>
const LAPTOP_API = 'http://localhost:3000/api/laptops';
const TOPSIS_API = 'http://localhost:3000/api/topsis';

let editId = null;

/* ================= ELEMENT ================= */
const nameInput = document.getElementById('name');
const priceInput = document.getElementById('price');
const ramInput = document.getElementById('ram');
const storageInput = document.getElementById('storage');
const processorInput = document.getElementById('processor');
const tableBody = document.getElementById('laptopTable');
const resultEl = document.getElementById('result');

/* ================= AUTH ================= */
function authHeader() {
  return {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  };
}

/* ================= READ ALL ================= */
function loadLaptops() {
  fetch(LAPTOP_API, { headers: authHeader() })
    .then(res => {
      if (!res.ok) throw new Error('Gagal ambil data');
      return res.json();
    })
    .then(data => {
      tableBody.innerHTML = '';

      data.forEach((d, i) => {
        tableBody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${d.name}</td>
            <td>${d.price}</td>
            <td>${d.ram} GB</td>
            <td>${d.storage} GB</td>
            <td>${d.processor}</td>
            <td>
              <button class="btn btn-primary" onclick="editLaptop(${d.id})">Edit</button>
              <button class="btn btn-success" onclick="deleteLaptop(${d.id})">Hapus</button>
            </td>
          </tr>
        `;
      });
    })
    .catch(err => alert(err.message));
}

/* ================= CREATE / UPDATE ================= */
function saveLaptop() {
  const data = {
    name: nameInput.value.trim(),
    price: Number(priceInput.value),
    ram: Number(ramInput.value),
    storage: Number(storageInput.value),
    processor: Number(processorInput.value)
  };

  if (
    !data.name ||
    isNaN(data.price) ||
    isNaN(data.ram) ||
    isNaN(data.storage) ||
    isNaN(data.processor)
  ) {
    alert('Semua field wajib diisi dengan benar');
    return;
  }

  const method = editId ? 'PUT' : 'POST';
  const url = editId ? `${LAPTOP_API}/${editId}` : LAPTOP_API;

  fetch(url, {
    method,
    headers: authHeader(),
    body: JSON.stringify(data)
  })
    .then(res => {
      if (!res.ok) throw new Error('Gagal simpan data');
      return res.json();
    })
    .then(() => {
      alert(editId ? 'Laptop diperbarui' : 'Laptop ditambahkan');
      resetForm();
      loadLaptops();
    })
    .catch(err => alert(err.message));
}

/* ================= EDIT ================= */
function editLaptop(id) {
  fetch(`${LAPTOP_API}/${id}`, { headers: authHeader() })
    .then(res => res.json())
    .then(d => {
      nameInput.value = d.name;
      priceInput.value = d.price;
      ramInput.value = d.ram;
      storageInput.value = d.storage;
      processorInput.value = d.processor;
      editId = d.id;
    });
}

/* ================= DELETE ================= */
function deleteLaptop(id) {
  if (!confirm('Yakin ingin menghapus laptop ini?')) return;

  fetch(`${LAPTOP_API}/${id}`, {
    method: 'DELETE',
    headers: authHeader()
  })
    .then(res => {
      if (!res.ok) throw new Error('Gagal hapus');
      loadLaptops();
    })
    .catch(err => alert(err.message));
}

/* ================= RESET ================= */
function resetForm() {
  nameInput.value = '';
  priceInput.value = '';
  ramInput.value = '';
  storageInput.value = '';
  processorInput.value = '';
  editId = null;
}

/* ================= TOPSIS ================= */
function getResult() {
  fetch(TOPSIS_API, { headers: authHeader() })
    .then(res => res.json())
    .then(data => {
      resultEl.innerHTML = data.map((d, i) => `
        <li>
          <b>${i + 1}. ${d.name}</b><br>
          Score: ${Number(d.score).toFixed(4)}
        </li>
      `).join('');
    });
}

/* ================= INIT ================= */
document.addEventListener('DOMContentLoaded', loadLaptops);
</script>


</body>
</html>
